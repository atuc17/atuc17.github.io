---
layout: post
title: Chương 4 - MÃ HÓA TRÊN ĐƯỜNG CONG ELLIPTIC (Phần 1)
categories: [cryptography]
---
# Phần 1: Nhập môn đường cong Elliptic - Một số định nghĩa và khái niệm
Đường cong Elliptic là đường cong có phương trình:

$$Y^2 = X^3 + AX + B$$, với điều kiện $$\Delta = 4A^3 + 27B^2 \neq 0$$

Phương trình loại này được gọi là phương trình Weierstrass (tên 1 nhà toán học).

Đồ thị của phương trình này là 1 trong 3 dạng sau:

A = -3, B = 5
![ecc1](/assets/crypto/ecc1.png)

A = 3, B = 5
![ecc2](/assets/crypto/ecc2.png)

A = -4, B = 3
![ecc3](/assets/crypto/ecc3.png)

Mình dùng thư viện matplotlib và numpy của python để vẽ vì khá thú vị :))) Sau đây là code của mình

```python
import numpy as np 
import matplotlib.pyplot as plt 

a = -4
b = 3
y, x = np.ogrid[-5:5:100j, -5:5:100j]
plt.contour(x.ravel(), y.ravel(), pow(y, 2) - pow(x, 3) - x * a - b, [0])
plt.grid()
plt.show()
```

## I. Phép cộng trên Elliptic

Trong đường cong elliptic, ta định nghĩa thêm một điểm $$O$$ (gọi là điểm vô cực).

Gọi $$E(a, b)$$ là tập hợp các điểm thuộc đường cong $$y^2 = x^3 + ax + b$$ và điểm $$O$$, ta định nghĩa phép cộng trên tập các điểm $$E(a, b)$$ như sau:

- 1) Điểm $$O$$ là phần tử đơn vị của phép cộng. Như vậy với $$P \in E(a, b)$$ và $$P \neq 0$$ thì $$P+O=O+P=P$$. 

Trong các phần kế tiếp, ta giả định $$P \neq 0 \; \text{và} \; Q \neq 0$$

- 2) Phần tử nghịch đảo của $$P$$ trong phép cộng: ta ký hiệu $$-P$$ là điểm đối xứng với $$P$$ qua $$Ox$$ và $$P+(-P)=O$$.

- 3) Với 2 điểm $$P$$, $$Q$$ bất kì, ta vẽ 1 đường thẳng đi qua $$P$$, $$Q$$ thì đường thẳng này cắt Elliptic tại điểm thứ 3 là $$S$$. Phép cộng $$P+Q$$ có kết quả là $$R=P+Q=-S$$

![ecc4](/assets/crypto/ecc4.png)

Trong trường hợp $$P$$ và $$Q$$ đối xứng qua $$Ox$$, $$Q = -P$$ thì đường thẳng đi qua $$P$$, $$Q$$ sẽ cắt Elliptic tại vô cực, hay $$P+(-P)=O$$. Điều này phù hợp với định nghĩa 2 ở trên.

![ecc5](/assets/crypto/ecc5.png)

- 4) Để tính $$P+P$$, ta vẽ đường tiếp tuyến với Elliptic tại $$P$$. Tiếp tuyến này cắt Elliptic tại $$S$$. Khi đó $$R = P+P=-S$$.

![ecc6](/assets/crypto/ecc6.png)

**Kết luận**: Đường cong Elliptic $$E(a, b)$$ cùng với điểm vô cực $$O$$ và phép cộng được định nghĩa như trên tạo nên 1 nhóm Abel.

## II. Tính giá trị của phép cộng

Gọi tọa độ $$P = (x_P, y_P)$$ và $$Q = (x_Q, y_Q)$$. 

### 1. Tính P+Q

Gọi $$R = (x_R, y_R)$$ là kết quả của phép cộng $$R = P+Q = -S$$. Bài viết này mình sẽ tìm tọa độ của $$R$$ rồi rút ra công thức tọa độ của $$R$$.

Từ định nghĩa của phép cộng $$P+Q$$, mình gọi $$(d)$$ là đường thẳng đi qua $$P$$, $$Q$$. Như vậy $$(d)$$ có hệ số góc là $$\Delta = \frac{y_Q - y_P}{x_Q - x_P}$$

Từ đó ta có phương trình đường thẳng $$(d): y = \frac{y_Q - y_P}{x_Q - x_P} (x - x_P) + y_P = \Delta (x - x_P) + y_P$$.

Gọi $$S = (x_S, y_S)$$ là giao điểm của $$(d)$$ và Elliptic. Phương trình hoành độ giao điểm của $$(d)$$ và Elliptic là:

$${[\Delta (x - x_P) + y_P]}^2 = x^3 + ax + b$$

Khai triển phương trình trên về dạng $$x^3 + ux^2 + vx + w = 0 \tag{*}$$ Mình có hệ số của $$x^2$$ là $$-\Delta ^2$$.

Theo định lý Viete, do $$x_P$$, $$x_Q$$, $$x_S$$ là 3 nghiệm của phương trình $$(1)$$ nên:

$$x_P + x_Q + x_S = \Delta ^2$$, tức là $$x_S = \Delta ^2 - x_P - x_Q$$.

Thay hoành độ $$x_S$$ vào $$(d)$$ ta có tung độ $$y_S = \Delta (x_S - x_P) + y_P$$

Do $$R$$ đối xứng $$S$$ qua $$Ox$$ nên 

$$\begin{align*}
x_R &= x_S = \Delta ^2 - x_P - x_Q \tag{1}\\ 
y_R &= -y_S = \Delta (x_R - x_P) - y_P \tag{2}
\end{align*}$$

Đây là công thức của phép cộng 2 điểm khác nhau

### 2. Tính P+P

Tương tự, mình thực hiện tính tọa độ $$R = P+P = -S$$ với điều kiện $$y_P \neq 0$$

Mình gọi $$(d)$$ là tiếp tuyến của Elliptic đi qua điểm $$P = (x_P, y_P)$$. Khi lấy vi phân 2 vế phương trình $$y^2 = x^3 + ax + b$$ mình được:

$$2ydy = (3x^2 + a)dx$$

Suy ra hệ số góc của đường thẳng $$(d)$$ là: $$\Delta = \frac{dy}{dx} = \frac{3x^2+a}{2y}$$, tức là $$\Delta = \frac{3{x_P}^2+a}{2y_P}$$

Từ đó mình có phương trình đường thẳng $$(d): y = \frac{3{x_P}^2+a}{2y_P}(x-x_P) + y_P = \Delta (x-x_P) + y_P$$

Phương trình hoành độ giao điểm của $$(d)$$ và Elliptic:

$$\Big[\Delta(x-x_P) + y_P\Big]^2 = x^3 + ax + b$$

Khai triển phương trình trên về dạng $$x^3 + ix^2 + jx + k = 0 \tag{**}$$. Mình có hệ số của $$x^2$$ là $$-\Delta ^2$$.

Cũng theo định lý Viete, với $$x_P$$, $$x_S$$ là nghiệm của phương trình $$(2)$$ và $$x_P$$ là nghiệm kép (do $$(d)$$ tiếp xúc Elliptic tại $$P$$) nên:

$$2x_P + x_S = \Delta ^2$$, tức là $$x_S = \Delta ^2 - 2x_P$$.

Thay hoành độ $$x_S$$ vào đường thẳng $$(d)$$: $$y_S = \Delta (x_S - x_P) + y_P$$

Do $$R$$ đối xứng $$S$$ qua $$Ox$$ nên:

$$\begin{align*}
x_R &= x_S = \Delta^2 - 2x_P \tag{3} \\
y_R &= -y_S = \Delta (x_P - x_R) - y_P \tag{4}
\end{align*}$$

## III. Tổng kết

Sau 1 hồi chém gió, mình rút ra công thức cho phép cộng trên đường cong Elliptic là:

 $$\begin{align*}
x_R &= x_S = \Delta ^2 - x_P - x_Q \\ 
y_R &= -y_S = \Delta (x_R - x_P) - y_P
\end{align*}$$. Trong đó $$\Delta = \begin{cases}
\frac{y_Q - y_P}{x_Q - x_P} \quad & \text{nếu} \; P \neq Q \\
\frac{3{x_P}^2}{2y_P} \quad & \text{nếu} \; P = Q
\end{cases}$$

Phần tiếp theo: Đường cong Elliptic trên trường $$\mathbb{Z}_p$$. Tại [đây](Elliptic-2.html)