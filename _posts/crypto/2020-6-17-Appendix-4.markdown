---
layout: post
title: Phụ lục 4 - Mã hóa và tính toán trong GF(2^n)
categories: [cryptography]
---
Trong mã hóa, ta cần sử dụng trường nào đó, để việc tính toán bản rõ và bản mã không ra khỏi trường. Nếu ta chọn trường số thực $$\mathbb{R}$$ thì sẽ khó khăn trong việc tính toán vì máy tính làm việc tốt nhất với bit nhưng dễ bị sai số khi làm việc với số thực. 

Một hướng tiếp cận khác là dùng trường số nguyên tố $$\mathbb{Z}_p$$. Vấn đề ở đây lại là, 1 byte có 8 bit nên ta cần dùng $$\mathbb{Z}_{256}$$ nhưng đây không phải trường. Nếu dùng $$\mathbb{Z}_{251}$$ là trường nguyên tố lại không thể sử dụng 252 tới 255.

Do đó, trường $$GF(2^8)$$ là 1 giải pháp, vì trường này có 256 phần tử. Ta có thể ánh xạ 1 hàm đa thức trong $$GF(2^n)$$ thành 1 số nhị phân tương ứng bằng cách lấy các hệ số của đa thức tạo thành dãy bit $$a_{n-1}a_{n-2}.....a_1a_0$$.

Ví dụ: xét trường $$GF(2^3)$$ với đa thức tối giản $$m(x) = x^3+x+1$$. Ta có bảng đa thức và dãy bit tương ứng như sau:

| Đa thức | Dãy bit |
| 0 | 000 |
| 1 | 001 |
| x | 010 |
| x + 1 | 011 |
| x<sup>2</sup> | 100 |
| x<sup>2</sup> + 1 | 101 |
| x<sup>2</sup> + x | 110 |
| x<sup>2</sup> + x + 1 | 111 |

## 1. Phép cộng

Cho 2 đa thức: $$f(x) = \sum_0^{n-1} a_ix^i$$ và $$g(x) = \sum_0^{n-1} b_ix^i$$ trong $$GF(2^n)$$.

Phép cộng $$f(x)+g(x)$$ chính là phép XOR 2 dãy bit $$a_{n-1}a_{n-1}....a_1a_0$$ và $$b_{n-1}b_{n-2}....b_1b_0$$, vì với 2 bit a, b:

- Nếu a = b = 1 hoặc a = b = 0 thì (a+b) mod 2 = 0
- Nếu a = 1, b = 0 hoặc a = 0, b = 1 thì (a+b) mod 2 = 1

## 2. Phép nhân
Phép nhân có liên quan đến phép modulo đa thức m(x).

Trong trường $$GF(2^8)$$, xét đa thức tối giản $$m(x) = x^8 + x^4 + x^3 + x + 1$$.

Ta có nhận xét sau:

$$x^8 \; mod \; m(x) \; = x^4 + x^3 + x + 1 \tag{*}$$

Một đa thức bất kì trong $$GF(2^8)$$ có dạng: 

$$f(x) = b_7x^7 + b_6x^6 + b_5x^5 + b_4x^4 + b_3x^3 + b_2x^2 + b_1x + b_0$$

Nhân 2 vế cho x ta có:

$$xf(x) = b_7x^8 + b_6x^7 + b_5x^6 + b_4x^5 + b_3x^4 + b_2x^3 + b_1x^2 + b_0x \; mod \; m(x)$$

- Nếu $$b_7=0$$ thì $$xf(x) = b_6x^7 + b_5x^6 + b_4x^5 + b_3x^4 + b_2x^3 + b_1x^2 + b_0x$$
- Nếu $$b_7=1$$ thì 

$$\begin{align*}
xf(x) &= x^8 + b_6x^7 + b_5x^6 + b_4x^5 + b_3x^4 + b_2x^3 + b_1x^2 + b_0x \\ &= (x^8) + (b_6x^7 + b_5x^6 + b_4x^5 + b_3x^4 + b_2x^3 + b_1x^2 + b_0x) \\ &= (x^4 + x^3 + x + 1) + (b_6x^7 + b_5x^6 + b_4x^5 + b_3x^4 + b_2x^3 + b_1x^2 + b_0x)
\end{align*}$$

Như đã nói, x tương ứng dãy bit 00000010 trong $$GF(2^n)$$. Vậy nếu viết phép tính $$xf(x)$$ trên theo dãy bit sẽ là:

$$b_7b_6b_5b_4b_3b_2b_1b_0 \times 00000010 = 
\begin{cases}
b_6b_5b_4b_3b_2b_1b_00 & \; nếu \; b_7 = 0 \\ b_6b_5b_4b_3b_2b_1b_00 \oplus 00011011 & \; nếu \; b_7 = 1
\end{cases}$$

Áp dụng lặp như vậy với k bất kì ta tính được $$x^kf(x) = x^{k-1} xf(x)$$, từ đó tính được $$g(x) \times f(x)$$

**Ví dụ**: tính $$(x^6 + x^4 + x^2 + x + 1) \times (x^7 + x + 1) \tag{I}$$

Viết phép nhân trên theo bit: $$01010111 \times 10000011$$. Như vậy ta có: $$ (I) = (x^6 + x^4 + x^2 + x + 1) \times x^7 + (x^6 + x^4 + x^2 + x + 1) \times x + (x^6 + x^4 + x^2 + x + 1) \times 1$$

Gọi $$f(x) = (x^6 + x^4 + x^2 + x + 1)$$,

Lưu ý rằng từ bước thứ 2 trở đi, đầu vào ở bước i sẽ là kết quả của bước i-1 dịch trái 1 bit

$$\begin{align*}
xf(x) & = 01010111 \times 00000010 = \textbf{10101110} \\
x^2f(x) & = 01010111 \times 00000100 = \textbf{01011100} \oplus 00011011 = \textbf{01000111} \\
x^3f(x) & = 01010111 \times 00001000 = \textbf{10001110} \\
x^4f(x) & = 01010111 \times 00010000 = \textbf{00011100} \oplus 00011011 = \textbf{00000111} \\
x^5f(x) & = 01010111 \times 00100000 = \textbf{00001110} \\
x^6f(x) & = 01010111 \times 01000000 = \textbf{00011100} \\
x^7f(x) & = 01010111 \times 10000000 = \textbf{00111000}
\end{align*}$$

Vì vậy, $$\begin{align*}01010111 \times 10000011 & = (01010111 \times 10000000) \oplus (01010111 \times 00000010) \oplus (01010111 \times 00000001) \\ & = 00111000 \oplus 10101110 \oplus 01010111 \\ & = 11000001 = x^7 + x^6 + 1\end{align*}$$

## 3. Tính toán với phần tử sinh

Khái niệm **phần tử sinh**: giá trị **g** được gọi là phần tử sinh của trường $$GF(2^n)$$ với đa thức tối giản m(x) nếu các lũy thừa $$g^0, g^1, g^2, ..., g^{n-2}$$ (n-1 phần tử) sinh ra các đa thức khác 0 của trường. Phép lũy thừa trên được modulo cho đa thức m(x).

**Điều kiện** để g là phần tử sinh: $$g^n = m(g) - g^n$$

**Ví dụ**: xét trường $$GF(2^3)$$ với $$m(x)=x^3+x+1$$. Như vậy để g là phần tử sinh thì $$g^3 = m(g) - g^3 = g + 1$$. 

Ta thực hiện sinh các phần tử của trường như sau:

$$\begin{align*}
g^0 &= 1 \\
g^1 &= g \\
g^2 &= g^2 \\
g^3 &= g+1 \\
g^4 &= g.g^3 = g(g+1) = g^2+g \\
g^5 &= g.g^4 = g(g^2+g) = g^3+g^2 = g^2+g+1 \\
g^6 &= g.g^5 = g(g^2+g+1) = g^3 + g^2 + g = g^2 + 1
\end{align*}$$

Bảng giá trị của trường với phần tử sinh

$$
\begin{array} {|c|c|c|c|}
 \hline
 \text{Lũy thừa} & \text{Đa thức} & \text{Nhị phân} & \text{Thập lục phân} \\ 
 \hline
 0 & 0 & 000 & 0 \\ 
 \hline
 g^0 & 1 & 001 & 1 \\
 \hline
 g^1 & g & 010 & 2 \\
 \hline
 g^2 & g^2 & 100 & 4 \\
 \hline
 g^3 & g+1 & 011 & 3 \\
 \hline
 g^4 & g^2+g & 110 & 6 \\
 \hline
 g^5 & g^2+g+1 & 111 & 7 \\
 \hline
 g^6 & g^2+1 & 101 & 5 \\ 
 \hline
\end{array}
$$

Ta có thể thực hiện phép nhân bằng phần tử sinh với phép modulo $$2^n-1$$. Ví dụ để tính $$(g+1)(g^2+g)$$, ta chuyển thành $$g^6.g^4 = g^{10 \; mod \; 7} = g^3 = g+1$$